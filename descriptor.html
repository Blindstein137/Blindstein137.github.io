<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Matrix Transform Descriptor Demo</title>
  <style>
    body { background: #111; color: white; font-family: sans-serif; text-align: center; }
    canvas { background: #000; display: block; margin: 20px auto; border: 1px solid #444; }
    button { margin: 10px; padding: 8px 16px; font-size: 1em; }
  </style>
</head>
<body>
  <h1>Matrix Transformation Sequences</h1>
  <div>
    <button onclick="drawMode('rotateThenTranslate')">Rotate → Translate</button>
    <button onclick="drawMode('translateThenRotate')">Translate → Rotate</button>
    <button onclick="drawMode('both')">Both</button>
  </div>
  <canvas id="canvas"></canvas>

  <script type="module">
    import { getSceneDescriptor } from './scene_descriptor (1).js';
    import { read } from './read.js';
    import { draw } from './scene_draw.js';

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const scene = getSceneDescriptor();
    canvas.width = scene.canvas.width;
    canvas.height = scene.canvas.height;

    // Triangle base info
    const θ = Math.atan2(0.81, 0.6); // from instructor’s A' to B' vector
    const dx = 0.58;
    const dy = 0.81;

    function generateTriangles(mode) {
      const base = [];
      if (mode === 'rotateThenTranslate' || mode === 'both') {
        base.push({
          shape: "triangle",
          transform: ["rotate", θ, "translate", [dx, dy]],
          style: { stroke: "lime", fill: "transparent" },
          textOverride: "Rotate → Translate"
        });
      }
      if (mode === 'translateThenRotate' || mode === 'both') {
        base.push({
          shape: "triangle",
          transform: ["translate", [dx, dy], "rotate", θ],
          style: { stroke: "red", fill: "transparent" },
          textOverride: "Translate → Rotate"
        });
      }
      return base;
    }

    window.drawMode = (mode) => {
      const cleanScene = structuredClone(scene); // preserves primitives
      cleanScene.objects = cleanScene.objects.filter(obj => obj.shape !== 'triangle' && obj.shape !== 'label');
      cleanScene.objects.push(
        {
          shape: "triangle",
          transform: [],
          style: { stroke: "white", fill: "transparent" },
          textOverride: "Original"
        },
        ...generateTriangles(mode)
      );
      const instances = read(cleanScene);
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      draw(ctx, instances);
    };

    drawMode('both');
  </script>
</body>
</html>
